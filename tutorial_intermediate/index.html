<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Tutorials (Intermediate) - HRI Teleoperation Tutorial</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Tutorials (Intermediate)";
        var mkdocs_page_input_path = "tutorial_intermediate.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> HRI Teleoperation Tutorial
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../tutorial/">Tutorials (Beginner)</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="#">Tutorials (Intermediate)</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#dockerfiles">Dockerfiles</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#docker-compose">Docker Compose</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#ros">ROS</a>
    </li>
        </ul>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../resources/">Resources</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">HRI Teleoperation Tutorial</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Tutorials (Intermediate)</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="tutorials-intermediate">Tutorials (Intermediate)</h1>
<p>Before going on, let's go back to the <code>docker run hello-world</code> command. What <code>docker run</code> does is create a container from the <code>hello-world</code> image. You can create as many containers (completely unrelated) as you want from the same image. </p>
<p><strong>Note:</strong> We suggest you the <a href="https://code.visualstudio.com/docs/containers/overview">vscode docker</a> extension to <a href="https://code.visualstudio.com/docs/containers/overview#_docker-explorer">explore</a> all containers and images on your system.</p>
<p>You should also have noticed that <code>docker run</code> will <em>download</em> (or rather <code>pull</code>) the <code>hello-world</code> image from the web (actually from some known repositories, like <code>apt</code> does) if it was not found locally. Try one by one the commands below.</p>
<pre><code class="language-bash">docker rmi hello-world #will erase the local image
docker pull hello-world #only downloads the latest version of the image.
docker run hello-world #start a container with a random fancy name
docker run --name pippo hello-world #start a container named pippo
docker run --name pluto --rm hello-world #start a container named pippo, automatically remove it on stop (--rm)
docker container ls #list all running container
</code></pre>
<h2 id="dockerfiles">Dockerfiles</h2>
<p>In you went through the <a href="../tutorial/#ros">ROS tutorial</a>, you probably installed some <code>apt</code> packages to proceed, or maybe you manually <em>downloaded</em> some code from <code>git</code>.</p>
<p>The point is, if you loose the container for some reason, will you also loose all the installations you made, all the files you downloaded, within the container? The answer is "yes".</p>
<p>That's the reason why we use a <code>Dockerfile</code> to keep track of most of the installations. Let's consider the <a href="../tutorial/#c">learn the C++ basics</a> example.</p>
<pre><code class="language-bash">docker run -d -t --name ubuntu ubuntu #start a basic Linux container: -d sends it in the background (detach), -t keeps it running
docker exec -it ubuntu bash -c 'g++ --version' #gives error, g++ is not installed yet
docker exec -it ubuntu bash -c 'apt update &amp;&amp; apt install g++ -y' #install the C++ compiler, you will need it!
</code></pre>
<p>We can keep track of the <code>g++</code> installation with a <code>Dockerfile</code>. Create it from vscode and save it in a dedicated folder</p>
<pre><code class="language-dockerfile">FROM ubuntu
RUN apt update &amp;&amp; apt install g++ -y
</code></pre>
<p>How it works? Save it and use it to build a specialized Docker Image</p>
<pre><code class="language-bash">docker build -f /path/to/your/folder/Dockerfile -t my-image
</code></pre>
<p>so that if you start a container from the newly created image you will find <code>g++</code> already there</p>
<pre><code class="language-bash">docker run -d -t --name my-ubuntu my-image
docker exec -it ubuntu bash -c 'g++ --version' #no error, prints the compiler version
docker run -it --rm my-image g++ --version #test the new image in a single line
</code></pre>
<h2 id="docker-compose">Docker Compose</h2>
<p>Docker Containers can be composed together to form a modular architecture. For instance, consider a practical case on our teleoperation platform.</p>
<p>You are developing a super cool ROS package which turns a target 6D pose for the robot into target joint angles for the robotic arm. The vendor, Universal Robots in our case, provides us the ROS driver package, which will listen for your joint angle commands (via a <code>ros2 topic</code>) and will take care to send them to the robot.</p>
<p>The point is, are you sure that you want to test your new algorithm directly on real (very expensive) robots? Wouldn't you like to see first how the math that you implemented behaves? Maybe you'll find some bugs, so it's a good practice you test your codes on simulated robots first. Remember, simulated arms are free! </p>
<p>Here's where modularity helps you! Let's say that your ROS package is installed along with the UR driver into a dedicated container, let's call it <em>drivers</em>. You only need to start a second container which runs the simulator to start debugging. </p>
<p>Moreover, imagine that a colleague of yours has a container, let's name it <em>devices</em>, which turns mocap data into target 6D poses for the robots. You can just compose <em>devices</em> and <em>drivers</em> together and the teleoperation system is ready to go!</p>
<p>Whenever you're ready to test with real robots, just stop the simulator container and connect the <em>drivers</em> with your real robots.</p>
<h3 id="ros">ROS</h3>
<p>First, learn how it works in a <a href="https://docs.ros.org/en/jazzy/How-To-Guides/Run-2-nodes-in-single-or-separate-docker-containers.html#run-two-nodes-in-two-separate-docker-containers">minimal ROS architecture</a> example.</p>
<p>Try to add a custom service (i.e. a container supported by a specific image) to the compose architecture using the <a href="#dockerfiles">Dockerfile</a></p>
<pre><code class="language-yml">version: '2'

services:
    talker:
        image: osrf/ros:jazzy-desktop
        command: ros2 run demo_nodes_cpp talker
    listener:
        image: osrf/ros:jazzy-desktop
        command: ros2 run demo_nodes_cpp listener
        depends_on: talker
    my_service:
        build:
            dockerfile: /path/to/your/folder/Dockerfile
        command: g++ --version
</code></pre>
<pre><code class="language-bash">docker compose build my_service #build only my_service
docker compose up my_service #run only my_service
</code></pre>
<p>or </p>
<pre><code class="language-bash">docker compose build
docker compose up
</code></pre>
<p><strong>Note:</strong> Docker will take a lot of memory (disk) to store images and containers. Periodically remove unused images. Moreover clear the builder cache with <code>docker builder prune</code>. Cleaning the cache means that new builds will start almost from scratch, which means they eill take more time.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../tutorial/" class="btn btn-neutral float-left" title="Tutorials (Beginner)"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../resources/" class="btn btn-neutral float-right" title="Resources">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../tutorial/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../resources/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
